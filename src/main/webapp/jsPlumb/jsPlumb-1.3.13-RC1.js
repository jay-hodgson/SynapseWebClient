(function(){var Da=jsPlumbUtil.findWithFunction,db=jsPlumbUtil.indexOf,P=jsPlumbUtil.removeWithFunction,L=jsPlumbUtil.addWithFunction,Y=jsPlumbUtil.isArray,ia=jsPlumbUtil.isString,eb=jsPlumbUtil.isObject,x=function(l,f){return d.CurrentLibrary.getAttribute(k(l),f)},k=function(l){return d.CurrentLibrary.getElementObject(l)},Ea=function(l){return d.CurrentLibrary.getSize(k(l))},T=jsPlumbUtil.log,ja=function(){return""+(new Date).getTime()},Fa=function(l){var f=this,k=arguments,c=!1,z=l.parameters||
{},Q=f.idPrefix+(new Date).getTime(),t=null,y=null;f._jsPlumb=l._jsPlumb;f.getId=function(){return Q};f.tooltip=l.tooltip;f.hoverClass=l.hoverClass||f._jsPlumb.Defaults.HoverClass||d.Defaults.HoverClass;jsPlumbUtil.EventGenerator.apply(this);this.clone=function(){var c={};f.constructor.apply(c,k);return c};this.getParameter=function(c){return z[c]};this.getParameters=function(){return z};this.setParameter=function(c,d){z[c]=d};this.setParameters=function(c){z=c};this.overlayPlacements=[];var q=l.beforeDetach;
this.isDetachAllowed=function(c){var d=f._jsPlumb.checkCondition("beforeDetach",c);if(q)try{d=q(c)}catch(l){T("jsPlumb: beforeDetach callback failed",l)}return d};var Na=l.beforeDrop;this.isDropAllowed=function(c,d,q,l,k){var m=f._jsPlumb.checkCondition("beforeDrop",{sourceId:c,targetId:d,scope:q,connection:l,dropEndpoint:k});if(Na)try{m=Na({sourceId:c,targetId:d,scope:q,connection:l,dropEndpoint:k})}catch(w){T("jsPlumb: beforeDrop callback failed",w)}return m};var N=function(){if(t&&y){var c={};
d.extend(c,t);d.extend(c,y);delete f.hoverPaintStyle;c.gradient&&t.fillStyle&&delete c.gradient;y=c}};this.setPaintStyle=function(c,d){t=c;f.paintStyleInUse=t;N();d||f.repaint()};this.getPaintStyle=function(){return t};this.setHoverPaintStyle=function(c,d){y=c;N();d||f.repaint()};this.getHoverPaintStyle=function(){return y};this.setHover=function(d,q,l){if(!f._jsPlumb.currentlyDragging&&!f._jsPlumb.isHoverSuspended()&&(c=d,null!=f.hoverClass&&null!=f.canvas&&(d?x.addClass(f.canvas,f.hoverClass):x.removeClass(f.canvas,
f.hoverClass)),null!=y&&(f.paintStyleInUse=d?y:t,l=l||ja(),f.repaint({timestamp:l,recalc:!1})),f.getAttachedElements&&!q)){q=ja();l=f;var k=f.getAttachedElements();if(k)for(var m=0;m<k.length;m++)l&&l==k[m]||k[m].setHover(d,!0,q)}};this.isHover=function(){return c};var m=null;this.setZIndex=function(c){m=c};this.getZIndex=function(){return m};var x=d.CurrentLibrary,A="click dblclick mouseenter mouseout mousemove mousedown mouseup contextmenu".split(" "),L={mouseout:"mouseexit"},P=function(c,d,f){var q=
L[f]||f;x.bind(c,f,function(c){d.fire(q,d,c)})};this.attachListeners=function(c,d){for(var f=0;f<A.length;f++)P(c,d,A[f])};this.reattachListenersForElement=function(c){if(1<arguments.length){for(var d=0;d<A.length;d++)x.unbind(c,A[d]);for(d=1;d<arguments.length;d++)f.attachListeners(c,arguments[d])}};var H=[],G=function(c){return null==c?null:c.split(" ")},E=function(c){if(f.getDefaultType){for(var d=f.getTypeDescriptor(),q=jsPlumbUtil.merge({},f.getDefaultType()),l=0;l<H.length;l++)q=jsPlumbUtil.merge(q,
f._jsPlumb.getType(H[l],d));f.applyType(q);c||f.repaint()}};f.setType=function(c,d){H=G(c)||[];E(d)};f.getType=function(){return H};f.hasType=function(c){return-1!=jsPlumbUtil.indexOf(H,c)};f.addType=function(c,d){var q=G(c),l=!1;if(null!=q){for(var k=0;k<q.length;k++)f.hasType(q[k])||(H.push(q[k]),l=!0);l&&E(d)}};f.removeType=function(c,d){var f=G(c),q=!1;if(null!=f){for(var l=0;l<f.length;l++){var k;k=jsPlumbUtil.indexOf(H,f[l]);-1!=k?(H.splice(k,1),k=!0):k=!1;q=k||q}q&&E(d)}};f.toggleType=function(c,
d){var f=G(c);if(null!=f){for(var q=0;q<f.length;q++){var l=jsPlumbUtil.indexOf(H,f[q]);-1!=l?H.splice(l,1):H.push(f[q])}E(d)}};this.applyType=function(c){f.setPaintStyle(c.paintStyle);f.setHoverPaintStyle(c.hoverPaintStyle);if(c.parameters)for(var d in c.parameters)f.setParameter(d,c.parameters[d])}},Pa=function(l){Fa.apply(this,arguments);var f=this;this.overlays=[];var k=function(c){var l=null;if(Y(c)){var l=c[0],k=d.extend({component:f,_jsPlumb:f._jsPlumb},c[1]);3==c.length&&d.extend(k,c[2]);
l=new (d.Overlays[f._jsPlumb.getRenderMode()][l])(k);if(k.events)for(var m in k.events)l.bind(m,k.events[m])}else l=c.constructor==String?new (d.Overlays[f._jsPlumb.getRenderMode()][c])({component:f,_jsPlumb:f._jsPlumb}):c;f.overlays.push(l)},c=function(c){var l=f.defaultOverlayKeys||[];c=c.overlays;var k=function(c){return f._jsPlumb.Defaults[c]||d.Defaults[c]||[]};c||(c=[]);for(var m=0;m<l.length;m++)c.unshift.apply(c,k(l[m]));return c}(l);if(c)for(var z=0;z<c.length;z++)k(c[z]);var x=function(c){for(var d=
-1,l=0;l<f.overlays.length;l++)if(c===f.overlays[l].id){d=l;break}return d};this.addOverlay=function(c,d){k(c);d||f.repaint()};this.getOverlay=function(c){c=x(c);return 0<=c?f.overlays[c]:null};this.getOverlays=function(){return f.overlays};this.hideOverlay=function(c){(c=f.getOverlay(c))&&c.hide()};this.hideOverlays=function(){for(var c=0;c<f.overlays.length;c++)f.overlays[c].hide()};this.showOverlay=function(c){(c=f.getOverlay(c))&&c.show()};this.showOverlays=function(){for(var c=0;c<f.overlays.length;c++)f.overlays[c].show()};
this.removeAllOverlays=function(){for(var c in f.overlays)f.overlays[c].cleanup();f.overlays.splice(0,f.overlays.length);f.repaint()};this.removeOverlay=function(c){c=x(c);-1!=c&&(f.overlays[c].cleanup(),f.overlays.splice(c,1))};this.removeOverlays=function(){for(var c=0;c<arguments.length;c++)f.removeOverlay(arguments[c])};var t=function(c){c=d.extend({cssClass:c.cssClass,labelStyle:this.labelStyle,id:"__label",component:f,_jsPlumb:f._jsPlumb},c);return new (d.Overlays[f._jsPlumb.getRenderMode()].Label)(c)};
l.label&&this.overlays.push(t({label:l.label,location:l.labelLocation||f.defaultLabelLocation||0.5,labelStyle:l.labelStyle||f._jsPlumb.Defaults.LabelStyle||d.Defaults.LabelStyle}));this.setLabel=function(c){var d=f.getOverlay("__label");d?c.constructor==String||c.constructor==Function?d.setLabel(c):(c.label&&d.setLabel(c.label),c.location&&d.setLocation(c.location)):(d=t(c.constructor==String||c.constructor==Function?{label:c}:c),this.overlays.push(d));f._jsPlumb.isSuspendDrawing()||f.repaint()};
this.getLabel=function(){var c=f.getOverlay("__label");return null!=c?c.getLabel():null};this.getLabelOverlay=function(){return f.getOverlay("__label")};var y=this.applyType;this.applyType=function(c){y(c);f.removeAllOverlays();if(c.overlays)for(var d=0;d<c.overlays.length;d++)f.addOverlay(c.overlays[d],!0)}},Qa=function(d,f,k){d.bind("click",function(c,d){f.fire("click",f,d)});d.bind("dblclick",function(c,d){f.fire("dblclick",f,d)});d.bind("contextmenu",function(c,d){f.fire("contextmenu",f,d)});
d.bind("mouseenter",function(c,d){f.isHover()||(k(!0),f.fire("mouseenter",f,d))});d.bind("mouseexit",function(c,d){f.isHover()&&(k(!1),f.fire("mouseexit",f,d))})},la=0,gb=function(){var d=la+1;la++;return d},ta=function(l){this.Defaults={Anchor:"BottomCenter",Anchors:[null,null],ConnectionsDetachable:!0,ConnectionOverlays:[],Connector:"Bezier",ConnectorZIndex:null,Container:null,DragOptions:{},DropOptions:{},Endpoint:"Dot",EndpointOverlays:[],Endpoints:[null,null],EndpointStyle:{fillStyle:"#456"},
EndpointStyles:[null,null],EndpointHoverStyle:null,EndpointHoverStyles:[null,null],HoverPaintStyle:null,LabelStyle:{color:"black"},LogEnabled:!1,Overlays:[],MaxConnections:1,PaintStyle:{lineWidth:8,strokeStyle:"#456"},RenderMode:"svg",Scope:"jsPlumb_DefaultScope"};l&&d.extend(this.Defaults,l);this.logEnabled=this.Defaults.LogEnabled;var f={},w={};this.registerConnectionType=function(a,b){f[a]=d.extend({},b)};this.registerConnectionTypes=function(a){for(var b in a)f[b]=d.extend({},a[b])};this.registerEndpointType=
function(a,b){w[a]=d.extend({},b)};this.registerEndpointTypes=function(a){for(var b in a)w[b]=d.extend({},a[b])};this.getType=function(a,b){return"connection"===b?f[a]:w[a]};jsPlumbUtil.EventGenerator.apply(this);var c=this,z=gb(),Q=c.bind,t={},y;for(y in this.Defaults)t[y]=this.Defaults[y];this.bind=function(a,b){"ready"===a&&E?b():Q.apply(c,[a,b])};c.importDefaults=function(a){for(var b in a)c.Defaults[b]=a[b]};c.restoreDefaults=function(){c.Defaults=d.extend({},t)};var q=null,E=!1,N={},m={},V=
{},A={},la={},ba={},H={},G=[],ua=this.Defaults.Scope,Z=null,W=function(a,b,e){var c=a[b];null==c&&(c=[],a[b]=c);c.push(e);return c},ta=function(a,b){c.Defaults.Container?d.CurrentLibrary.appendElement(a,c.Defaults.Container):b?d.CurrentLibrary.appendElement(a,b):jsPlumbAdapter.appendToRoot(a)},fb=1,ka=function(){return""+fb++},U=function(a,b,e){if(!jsPlumbAdapter.headless&&!va){a=x(a,"id");var h=c.dragManager.getElementsForDraggable(a);null==e&&(e=ja());c.anchorManager.redraw(a,b,e);if(h)for(var d in h)c.anchorManager.redraw(h[d].id,
b,e,h[d].offset)}},Oa=function(a,b){var e=null;if(Y(a))for(var e=[],c=0;c<a.length;c++){var d=k(a[c]),g=x(d,"id");e.push(b(d,g))}else d=k(a),g=x(d,"id"),e=b(d,g);return e},Ga=function(a,b,e){if(!jsPlumbAdapter.headless){var h=d.CurrentLibrary;if((null==b?0:b)&&h.isDragSupported(a)&&!h.isAlreadyDraggable(a)){b=e||c.Defaults.DragOptions||d.Defaults.DragOptions;b=d.extend({},b);e=h.dragEvents.drag;var r=h.dragEvents.stop,g=h.dragEvents.start;b[g]=O(b[g],function(){c.setHoverSuspended(!0)});b[e]=O(b[e],
function(){var b=h.getUIPosition(arguments);U(a,b);d.CurrentLibrary.addClass(k(a),"jsPlumb_dragged")});b[r]=O(b[r],function(){var b=h.getUIPosition(arguments);U(a,b);d.CurrentLibrary.removeClass(k(a),"jsPlumb_dragged");c.setHoverSuspended(!1)});e=B(a);H[e]=!0;e=H[e];b.disabled=null==e?!1:!e;h.initDraggable(a,b,!1);c.dragManager.register(a)}}},Ra=function(a){var b=c.Defaults.ConnectionType||c.getDefaultConnectionType(),e=c.Defaults.EndpointType||Ha,h=d.CurrentLibrary.getParent;a.parent=a.container?
a.container:a.sourceEndpoint?a.sourceEndpoint.parent:a.source.constructor==e?a.source.parent:h(a.source);a._jsPlumb=c;a=new b(a);a.id="con_"+ka();fa("click","click",a);fa("dblclick","dblclick",a);fa("contextmenu","contextmenu",a);return a},Ia=function(a,b,e){b=b||{};a.suspendedEndpoint||W(N,a.scope,a);b.doNotFireConnectionEvent||!1===b.fireEvent||(b={connection:a,source:a.source,target:a.target,sourceId:a.sourceId,targetId:a.targetId,sourceEndpoint:a.endpoints[0],targetEndpoint:a.endpoints[1]},c.fire("jsPlumbConnection",
b,e),c.fire("connection",b,e));c.anchorManager.newConnection(a);U(a.source)},fa=function(a,b,e){e.bind(a,function(a,d){c.fire(b,e,d)})},Sa=function(a){if(a.container)return a.container;var b=d.CurrentLibrary.getTagName(a.source);a=d.CurrentLibrary.getParent(a.source);return b&&"td"===b.toLowerCase()?d.CurrentLibrary.getParent(a):a},wa=function(a){var b=c.Defaults.EndpointType||Ha;a.parent=Sa(a);a._jsPlumb=c;a=new b(a);a.id="ep_"+ka();fa("click","endpointClick",a);fa("dblclick","endpointDblClick",
a);fa("contextmenu","contextmenu",a);return a},Ja=function(a,b,e){if((a=m[a])&&a.length)for(var c=0;c<a.length;c++){for(var d=0;d<a[c].connections.length;d++)if(b(a[c].connections[d]))return;e&&e(a[c])}},Ta=function(a,b){null!=a&&null!=a.parentNode&&a.parentNode.removeChild(a)},ma=function(a,b){for(var e=0;e<a.length;e++)Ta(a[e],b)},Ua=function(a,b,e){b="block"===b;var c=null;e&&(c=b?function(a){a.setVisible(!0,!0,!0)}:function(a){a.setVisible(!1,!0,!0)});var d=x(a,"id");Ja(d,function(a){b&&e?a.endpoints[a.sourceId===
d?1:0].isVisible()&&a.setVisible(!0):a.setVisible(b)},c)};l=function(a,b){var e=null;b&&(e=function(a){var b=a.isVisible();a.setVisible(!b)});Ja(a,function(a){var b=a.isVisible();a.setVisible(!b)},e)};var J=function(a){var b=a.timestamp,e=a.recalc,c=a.offset;a=a.elId;if(!e&&b&&b===la[a])return A[a];e||!c?(e=k(a),null!=e&&(G[a]=Ea(e),A[a]=d.CurrentLibrary.getOffset(k(e)),la[a]=b)):(A[a]=c,null==G[a]&&(e=k(a),null!=e&&(G[a]=Ea(e))));A[a]&&!A[a].right&&(A[a].right=A[a].left+G[a][0],A[a].bottom=A[a].top+
G[a][1],A[a].width=G[a][0],A[a].height=G[a][1],A[a].centerx=A[a].left+A[a].width/2,A[a].centery=A[a].top+A[a].height/2);return A[a]},Va=function(a){var b=A[a];b||(b=J({elId:a}));return{o:b,s:G[a]}},B=function(a,b,e){var c=k(a),r=x(c,"id");if(!r||"undefined"==r){if(2==arguments.length&&void 0!=arguments[1])r=b;else if(1==arguments.length||3==arguments.length&&!arguments[2])r="jsPlumb_"+z+"_"+ka();var g=r;d.CurrentLibrary.setAttribute(k(c),"id",g)}return r},O=function(a,b,e){a=a||function(){};b=b||
function(){};return function(){var d=null;try{d=b.apply(this,arguments)}catch(r){T(c,"jsPlumb function failed : "+r)}if(null==e||d!==e)try{a.apply(this,arguments)}catch(g){T(c,"wrapped function failed : "+g)}return d}};this.connectorClass="_jsPlumb_connector";this.endpointClass="_jsPlumb_endpoint";this.overlayClass="_jsPlumb_overlay";this.Anchors={};this.Connectors={canvas:{},svg:{},vml:{}};this.Endpoints={canvas:{},svg:{},vml:{}};this.Overlays={canvas:{},svg:{},vml:{}};this.addClass=function(a,b){return d.CurrentLibrary.addClass(a,
b)};this.removeClass=function(a,b){return d.CurrentLibrary.removeClass(a,b)};this.hasClass=function(a,b){return d.CurrentLibrary.hasClass(a,b)};this.addEndpoint=function(a,b,e){e=e||{};e=d.extend({},e);d.extend(e,b);e.endpoint=e.endpoint||c.Defaults.Endpoint||d.Defaults.Endpoint;e.paintStyle=e.paintStyle||c.Defaults.EndpointStyle||d.Defaults.EndpointStyle;a=a._nodes?a._nodes:a;b=[];a=a.length&&a.constructor!=String?a:[a];for(var h=0;h<a.length;h++){var r=k(a[h]),g=B(r);e.source=r;J({elId:g});var f=
wa(e);e.parentAnchor&&(f.parentAnchor=e.parentAnchor);W(m,g,f);var l=A[g],g=f.anchor.compute({xy:[l.left,l.top],wh:G[g],element:f});f.paint({anchorLoc:g});b.push(f);jsPlumbAdapter.headless||c.dragManager.endpointAdded(r)}return 1==b.length?b[0]:b};this.addEndpoints=function(a,b,e){for(var d=[],r=0;r<b.length;r++){var g=c.addEndpoint(a,b[r],e);Y(g)?Array.prototype.push.apply(d,g):d.push(g)}return d};this.animate=function(a,b,e){var h=k(a),r=x(a,"id");e=e||{};a=d.CurrentLibrary.dragEvents.step;var g=
d.CurrentLibrary.dragEvents.complete;e[a]=O(e[a],function(){c.repaint(r)});e[g]=O(e[g],function(){c.repaint(r)});d.CurrentLibrary.animate(h,b,e)};this.checkCondition=function(a,b){var e=c.getListener(a),d=!0;if(e&&0<e.length)try{for(var r=0;r<e.length;r++)d=d&&e[r](b)}catch(g){T(c,"cannot check condition ["+a+"]"+g)}return d};this.connect=function(a,b){var e;a:{e=d.extend({},a);b&&d.extend(e,b);e.source&&e.source.endpoint&&(e.sourceEndpoint=e.source);e.source&&e.target.endpoint&&(e.targetEndpoint=
e.target);a.uuids&&(e.sourceEndpoint=V[a.uuids[0]],e.targetEndpoint=V[a.uuids[1]]);if(e.sourceEndpoint&&e.sourceEndpoint.isFull())T(c,"could not add connection; source endpoint is full");else if(e.targetEndpoint&&e.targetEndpoint.isFull())T(c,"could not add connection; target endpoint is full");else{!e.type&&e.sourceEndpoint&&(e.type=e.sourceEndpoint.connectionType);if(e.sourceEndpoint&&e.sourceEndpoint.connectorOverlays){e.overlays=e.overlays||[];for(var h=0;h<e.sourceEndpoint.connectorOverlays.length;h++)e.overlays.push(e.sourceEndpoint.connectorOverlays[h])}e.tooltip=
a.tooltip;!e.tooltip&&e.sourceEndpoint&&e.sourceEndpoint.connectorTooltip&&(e.tooltip=e.sourceEndpoint.connectorTooltip);if(e.target&&!e.target.endpoint&&!e.targetEndpoint&&!e.newConnection){var h=B(e.target),r=na[h],g=oa[h];if(r){if(!R[h]){e=void 0;break a}r=null!=g?g:c.addEndpoint(e.target,r);pa[h]&&(oa[h]=r);e.targetEndpoint=r;r._makeTargetCreator=!0}}if(e.source&&!e.source.endpoint&&!e.sourceEndpoint&&!e.newConnection&&(h=B(e.source),r=qa[h],g=Ka[h],r)){if(!S[h]){e=void 0;break a}r=null!=g?g:
c.addEndpoint(e.source,r);ra[h]&&(Ka[h]=r);e.sourceEndpoint=r}break a}e=void 0}var f;e&&(null==e.deleteEndpointsOnDetach&&(e.deleteEndpointsOnDetach=!0),f=Ra(e),Ia(f,e));return f};this.deleteEndpoint=function(a){if(a="string"==typeof a?V[a]:a){var b=a.getUuid();b&&(V[b]=null);a.detachAll();a.endpoint.cleanup&&a.endpoint.cleanup();ma(a.endpoint.getDisplayElements());c.anchorManager.deleteEndpoint(a);for(var e in m)if(b=m[e]){for(var d=[],r=0;r<b.length;r++)b[r]!=a&&d.push(b[r]);m[e]=d}jsPlumbAdapter.headless||
c.dragManager.endpointDeleted(a)}};this.deleteEveryEndpoint=function(){c.setSuspendDrawing(!0);for(var a in m){var b=m[a];if(b&&b.length)for(var e=0;e<b.length;e++)c.deleteEndpoint(b[e])}delete m;m={};delete V;V={};c.setSuspendDrawing(!1,!0)};var Wa=function(a,b,e){var d=c.Defaults.ConnectionType||c.getDefaultConnectionType();a=a.constructor==d?{connection:a,source:a.source,target:a.target,sourceId:a.sourceId,targetId:a.targetId,sourceEndpoint:a.endpoints[0],targetEndpoint:a.endpoints[1]}:a;b&&(c.fire("jsPlumbConnectionDetached",
a,e),c.fire("connectionDetached",a,e));c.anchorManager.connectionDetached(a)};this.detach=function(){if(0!=arguments.length){var a=c.Defaults.ConnectionType||c.getDefaultConnectionType(),b=arguments[0].constructor==a,a=2==arguments.length?b?arguments[1]||{}:arguments[0]:arguments[0],e=!1!==a.fireEvent,h=a.forceDetach;if(b=b?arguments[0]:a.connection)(h||b.isDetachAllowed(b)&&b.endpoints[0].isDetachAllowed(b)&&b.endpoints[1].isDetachAllowed(b))&&(h||c.checkCondition("beforeDetach",b))&&b.endpoints[0].detach(b,
!1,!0,e);else if(a=d.extend({},a),a.uuids)V[a.uuids[0]].detachFrom(V[a.uuids[1]],e);else if(a.sourceEndpoint&&a.targetEndpoint)a.sourceEndpoint.detachFrom(a.targetEndpoint);else{var r=B(a.source),g=B(a.target);Ja(r,function(a){(a.sourceId==r&&a.targetId==g||a.targetId==r&&a.sourceId==g)&&c.checkCondition("beforeDetach",a)&&a.endpoints[0].detach(a,!1,!0,e)})}}};this.detachAllConnections=function(a,b){b=b||{};a=k(a);var e=x(a,"id");if((e=m[e])&&e.length)for(var c=0;c<e.length;c++)e[c].detachAll(b.fireEvent)};
this.detachEveryConnection=function(a){a=a||{};for(var b in m){var c=m[b];if(c&&c.length)for(var d=0;d<c.length;d++)c[d].detachAll(a.fireEvent)}delete N;N={}};this.draggable=function(a,b){if("object"==typeof a&&a.length)for(var c=0;c<a.length;c++){var d=k(a[c]);d&&Ga(d,!0,b)}else if(a._nodes)for(c=0;c<a._nodes.length;c++)(d=k(a._nodes[c]))&&Ga(d,!0,b);else(d=k(a))&&Ga(d,!0,b)};this.extend=function(a,b){return d.CurrentLibrary.extend(a,b)};this.getDefaultEndpointType=function(){return Ha};this.getDefaultConnectionType=
function(){return hb};var C=function(a,b,c){return function(){for(var d=arguments,r=0;r<a.length;r++)a[r][b].apply(a[r],d);return c(a)}},M=function(a,b){return function(){for(var c=arguments,d=[],r=0;r<a.length;r++)d.push([a[r][b].apply(a[r],c),a[r]]);return d}},ca=function(a,b){var c=[];if(a)if("string"==typeof a){if("*"===a)return a;c.push(a)}else if(b)c=a;else for(var d=0;d<a.length;d++)c.push(B(k(a[d])));return c},da=function(a,b,c){return"*"===a?!0:0<a.length?-1!=db(a,b):!c};this.getConnections=
function(a,b){a?a.constructor==String&&(a={scope:a}):a={};var e=a.scope||c.getDefaultScope(),e=ca(e,!0),d=ca(a.source),r=ca(a.target),g=!b&&1<e.length?{}:[],f;for(f in N)if(da(e,f))for(var l=0;l<N[f].length;l++){var k=N[f][l];if(da(d,k.sourceId)&&da(r,k.targetId))if(!b&&1<e.length){var $=g[f];null==$&&($=[],g[f]=$);$.push(k)}else g.push(k)}return g};var ib=function(a,b){return function(c){for(var d=0;d<a.length;d++)c(a[d]);return b(a)}},jb=function(a){return function(b){return a[b]}},Ya=function(a,
b){return{setHover:C(a,"setHover",b),removeAllOverlays:C(a,"removeAllOverlays",b),setLabel:C(a,"setLabel",b),addOverlay:C(a,"addOverlay",b),removeOverlay:C(a,"removeOverlay",b),removeOverlays:C(a,"removeOverlays",b),showOverlay:C(a,"showOverlay",b),hideOverlay:C(a,"hideOverlay",b),showOverlays:C(a,"showOverlays",b),hideOverlays:C(a,"hideOverlays",b),setPaintStyle:C(a,"setPaintStyle",b),setHoverPaintStyle:C(a,"setHoverPaintStyle",b),setParameter:C(a,"setParameter",b),setParameters:C(a,"setParameters",
b),setVisible:C(a,"setVisible",b),setZIndex:C(a,"setZIndex",b),repaint:C(a,"repaint",b),addType:C(a,"addType",b),toggleType:C(a,"toggleType",b),removeType:C(a,"removeType",b),getLabel:M(a,"getLabel"),getOverlay:M(a,"getOverlay"),isHover:M(a,"isHover"),getParameter:M(a,"getParameter"),getParameters:M(a,"getParameters"),getPaintStyle:M(a,"getPaintStyle"),getHoverPaintStyle:M(a,"getHoverPaintStyle"),isVisible:M(a,"isVisible"),getZIndex:M(a,"getZIndex"),hasType:M(a,"hasType"),getType:M(a,"getType"),length:a.length,
each:ib(a,b),get:jb(a)}},xa=function(a){var b=Ya(a,xa);return d.CurrentLibrary.extend(b,{setDetachable:C(a,"setDetachable",xa),setConnector:C(a,"setConnector",xa),detach:function(){for(var b=0;b<a.length;b++)c.detach(a[b])},isDetachable:M(a,"isDetachable")})},La=function(a){var b=Ya(a,La);return d.CurrentLibrary.extend(b,{setEnabled:C(a,"setEnabled",La),isEnabled:M(a,"isEnabled"),detachAll:function(){for(var b=0;b<a.length;b++)a[b].detachAll()},"delete":function(){for(var b=0;b<a.length;b++)c.deleteEndpoint(a[b])}})};
this.select=function(a){a=a||{};a.scope=a.scope||"*";a=c.getConnections(a,!0);return xa(a)};this.selectEndpoints=function(a){a=a||{};a.scope=a.scope||"*";var b=!a.element&&!a.source&&!a.target,c=b?"*":ca(a.element),d=b?"*":ca(a.source),b=b?"*":ca(a.target);a=ca(a.scope,!0);var r=[],g;for(g in m){var f=da(c,g,!0),l=da(d,g,!0),k="*"!=d,$=da(b,g,!0),ea="*"!=b;if(f||l||$)a:for(f=0;f<m[g].length;f++)if(l=m[g][f],da(a,l.scope,!0)){$=ea&&0<b.length&&!l.isTarget;if(k&&0<d.length&&!l.isSource||$)continue a;
r.push(l)}}return La(r)};this.getAllConnections=function(){return N};this.getDefaultScope=function(){return ua};this.getEndpoint=function(a){return V[a]};this.getEndpoints=function(a){return m[B(a)]};this.getId=B;this.getOffset=function(a){return J({elId:a})};this.getSelector=function(a){return d.CurrentLibrary.getSelector(a)};this.getSize=function(a){G[a]||J({elId:a});return G[a]};this.appendElement=ta;var Za=!1;this.isHoverSuspended=function(){return Za};this.setHoverSuspended=function(a){Za=a};
y=function(a){return function(){return jsPlumbAdapter.isRenderModeAvailable(a)}};this.isCanvasAvailable=y("canvas");this.isSVGAvailable=y("svg");this.isVMLAvailable=y("vml");this.hide=function(a,b){Ua(a,"none",b)};this.idstamp=ka;this.init=function(){if(!E){c.setRenderMode(c.Defaults.RenderMode);var a=function(a){d.CurrentLibrary.bind(document,a,function(e){if(!c.currentlyDragging&&Z==d.CANVAS){for(var h in N)for(var f=N[h],g=0;g<f.length;g++)if(f[g].connector[a](e))return;for(var l in m)for(h=m[l],
g=0;g<h.length;g++)if(h[g].endpoint[a](e))return}})};a("click");a("dblclick");a("mousemove");a("mousedown");a("mouseup");a("contextmenu");E=!0;c.fire("ready")}};this.log=q;this.jsPlumbUIComponent=Fa;this.makeAnchor=function(){if(0==arguments.length)return null;var a=arguments[0],b=arguments[1],e=null;if(a.compute&&a.getOrientation)return a;if("string"==typeof a)e=d.Anchors[arguments[0]]({elementId:b,jsPlumbInstance:c});else if(Y(a))if(Y(a[0])||ia(a[0]))2==a.length&&ia(a[0])&&eb(a[1])?(b=d.extend({elementId:b,
jsPlumbInstance:c},a[1]),e=d.Anchors[a[0]](b)):e=new ya(a,null,b);else{var h={x:a[0],y:a[1],orientation:4<=a.length?[a[2],a[3]]:[0,0],offsets:6==a.length?[a[4],a[5]]:[0,0],elementId:b},e=new za(h);e.clone=function(){return new za(h)}}e.id||(e.id="anchor_"+ka());return e};this.makeAnchors=function(a,b,e){for(var h=[],f=0;f<a.length;f++)"string"==typeof a[f]?h.push(d.Anchors[a[f]]({elementId:b,jsPlumbInstance:e})):Y(a[f])&&h.push(c.makeAnchor(a[f],b,e));return h};this.makeDynamicAnchor=function(a,b){return new ya(a,
b)};var na={},oa={},pa={},ga={},$a=function(a,b){a.paintStyle=a.paintStyle||c.Defaults.EndpointStyles[b]||c.Defaults.EndpointStyle||d.Defaults.EndpointStyles[b]||d.Defaults.EndpointStyle;a.hoverPaintStyle=a.hoverPaintStyle||c.Defaults.EndpointHoverStyles[b]||c.Defaults.EndpointHoverStyle||d.Defaults.EndpointHoverStyles[b]||d.Defaults.EndpointHoverStyle;a.anchor=a.anchor||c.Defaults.Anchors[b]||c.Defaults.Anchor||d.Defaults.Anchors[b]||d.Defaults.Anchor;a.endpoint=a.endpoint||c.Defaults.Endpoints[b]||
c.Defaults.Endpoint||d.Defaults.Endpoints[b]||d.Defaults.Endpoint};this.makeTarget=function(a,b,e){var h=d.extend({_jsPlumb:c},e);d.extend(h,b);$a(h,1);var f=d.CurrentLibrary,g=h.scope||c.Defaults.Scope,l=!1!==h.deleteEndpointsOnDetach,p=h.maxConnections||-1,Xa=h.onMaxConnections;_doOne=function(a){var b=B(a);na[b]=h;pa[b]=h.uniqueEndpoint;ga[b]=p;R[b]=!0;proxyComponent=new Fa(h);var e=d.extend({},h.dropOptions||{}),m=f.dragEvents.drop;e.scope=e.scope||g;e[m]=O(e[m],function(){var e=d.CurrentLibrary.getDropEvent(arguments),
g=c.select({target:b}).length;c.currentlyDragging=!1;var p=k(f.getDragObject(arguments)),s=x(p,"dragId"),v=x(p,"originalScope"),s=ba[s],n=s.endpoints[0];h.endpoint&&d.extend({},h.endpoint);if(!R[b]||0<ga[b]&&g>=ga[b])return Xa&&Xa({element:a,connection:s},e),!1;n.anchor.locked=!1;v&&f.setDragScope(p,v);g=proxyComponent.isDropAllowed(s.sourceId,B(a),s.scope,s,null);s.endpointsToDeleteOnDetach&&(n===s.endpointsToDeleteOnDetach[0]?s.endpointsToDeleteOnDetach[0]=null:n===s.endpointsToDeleteOnDetach[1]&&
(s.endpointsToDeleteOnDetach[1]=null));s.suspendedEndpoint&&(s.targetId=s.suspendedEndpoint.elementId,s.target=f.getElementObject(s.suspendedEndpoint.elementId),s.endpoints[1]=s.suspendedEndpoint);if(g){n.detach(s,!1,!0,!1);e=oa[b]||c.addEndpoint(a,h);h.uniqueEndpoint&&(oa[b]=e);e._makeTargetCreator=!0;if(null!=e.anchor.positionFinder){var g=f.getUIPosition(arguments),p=f.getOffset(a),aa=f.getSize(a),g=e.anchor.positionFinder(g,p,aa,e.anchor.constructorParams);e.anchor.x=g[0];e.anchor.y=g[1]}v=c.connect({source:n,
target:e,scope:v,previousConnection:s,container:s.parent,deleteEndpointsOnDetach:l,doNotFireConnectionEvent:n.endpointWillMoveAfterConnection});s.endpoints[1]._makeTargetCreator&&2>s.endpoints[1].connections.length&&c.deleteEndpoint(s.endpoints[1]);l&&(v.endpointsToDeleteOnDetach=[n,e]);v.repaint()}else s.suspendedEndpoint&&(n.isReattach?(s.setHover(!1),s.floatingAnchorIndex=null,s.suspendedEndpoint.addConnection(s),c.repaint(n.elementId)):n.detach(s,!1,!0,!0,e))});f.initDroppable(a,e,!0)};a=a._nodes?
a._nodes:a;a=a.length&&a.constructor!=String?a:[a];for(b=0;b<a.length;b++)_doOne(k(a[b]));return c};this.unmakeTarget=function(a,b){a=d.CurrentLibrary.getElementObject(a);var e=B(a);b||(delete na[e],delete pa[e],delete ga[e],delete R[e]);return c};this.makeTargets=function(a,b,e){for(var d=0;d<a.length;d++)c.makeTarget(a[d],b,e)};var qa={},Ka={},ra={},S={},Aa={},sa={},R={};this.makeSource=function(a,b,e){var h=d.extend({},e);d.extend(h,b);$a(h,0);var f=d.CurrentLibrary,g=h.maxConnections||-1,l=h.onMaxConnections;
e=function(a){var e=B(a),p=h.parent,k=null!=p?c.getId(f.getElementObject(p)):e;qa[k]=h;ra[k]=h.uniqueEndpoint;S[k]=!0;var p=f.dragEvents.stop,m=f.dragEvents.drag,X=d.extend({},h.dragOptions||{}),q=X.drag,u=X.stop,s=null,v=!1;sa[k]=g;X.scope=X.scope||h.scope;X[m]=O(X[m],function(){q&&q.apply(this,arguments);v=!1});X[p]=O(X[p],function(){u&&u.apply(this,arguments);c.currentlyDragging=!1;if(0==s.connections.length)c.deleteEndpoint(s);else{f.unbind(s.canvas,"mousedown");var a=s.connections[0];s.anchor=
c.makeAnchor(h.anchor||c.Defaults.Anchor,e,c);if(h.parent){var b=f.getElementObject(h.parent);if(b){var g=s.elementId;s.setElement(b,h.container||c.Defaults.Container||d.Defaults.Container);s.endpointWillMoveAfterConnection=!1;c.anchorManager.rehomeEndpoint(g,b);a.previousConnection=null;P(N[a.scope],function(b){return b.id===a.id});c.anchorManager.connectionDetached({sourceId:a.sourceId,targetId:a.targetId,connection:a});Ia(a)}}s.repaint();c.repaint(s.elementId);c.repaint(a.targetId)}});p=function(n){if(S[k]){var p=
c.select({source:k}).length;if(0<=sa[k]&&p>=sa[k])return l&&l({element:a,maxConnections:g},n),!1;if(!b.filter||!1!==b.filter(f.getOriginalEvent(n),a)){var m=J({elId:e}),p=((n.pageX||n.page.x)-m.left)/m.width,u=((n.pageY||n.page.y)-m.top)/m.height,D=p,ea=u;h.parent&&(D=f.getElementObject(h.parent),D=B(D),m=J({elId:D}),D=((n.pageX||n.page.x)-m.left)/m.width,ea=((n.pageY||n.page.y)-m.top)/m.height);m={};d.extend(m,h);m.isSource=!0;m.anchor=[p,u,0,0];m.parentAnchor=[D,ea,0,0];m.dragOptions=X;h.parent&&
(p=m.container||c.Defaults.Container||d.Defaults.Container,m.container=p?p:d.CurrentLibrary.getParent(h.parent));s=c.addEndpoint(e,m);v=!0;s.endpointWillMoveAfterConnection=null!=h.parent;s.endpointWillMoveTo=h.parent?f.getElementObject(h.parent):null;p=function(){v&&c.deleteEndpoint(s)};c.registerListener(s.canvas,"mouseup",p);c.registerListener(a,"mouseup",p);f.trigger(s.canvas,"mousedown",n)}}};c.registerListener(a,"mousedown",p);Aa[e]=p};a=a._nodes?a._nodes:a;a=a.length&&a.constructor!=String?
a:[a];for(var p=0;p<a.length;p++)e(k(a[p]));return c};this.unmakeSource=function(a,b){a=d.CurrentLibrary.getElementObject(a);var e=B(a),h=Aa[e];h&&c.unregisterListener(_el,"mousedown",h);b||(delete qa[e],delete ra[e],delete S[e],delete Aa[e],delete sa[e]);return c};this.unmakeEverySource=function(){for(var a in S)c.unmakeSource(a,!0);qa={};ra={};S={};Aa={}};this.unmakeEveryTarget=function(){for(var a in R)c.unmakeTarget(a,!0);na={};pa={};ga={};R={};return c};this.makeSources=function(a,b,e){for(var d=
0;d<a.length;d++)c.makeSource(a[d],b,e);return c};var Ba=function(a,b,e,h){a="source"==a?S:R;if(ia(b))a[b]=h?!a[b]:e;else if(b.length){b=b._nodes?b._nodes:b;for(var f=0;f<b.length;f++){var g=_el=d.CurrentLibrary.getElementObject(b[f]),g=B(_el);a[g]=h?!a[g]:e}}return c};this.setSourceEnabled=function(a,b){return Ba("source",a,b)};this.toggleSourceEnabled=function(a){Ba("source",a,null,!0);return c.isSourceEnabled(a)};this.isSource=function(a){a=d.CurrentLibrary.getElementObject(a);return null!=S[B(a)]};
this.isSourceEnabled=function(a){a=d.CurrentLibrary.getElementObject(a);return!0===S[B(a)]};this.setTargetEnabled=function(a,b){return Ba("target",a,b)};this.toggleTargetEnabled=function(a){return Ba("target",a,null,!0)};this.isTarget=function(a){a=d.CurrentLibrary.getElementObject(a);return null!=R[B(a)]};this.isTargetEnabled=function(a){a=d.CurrentLibrary.getElementObject(a);return!0===R[B(a)]};this.ready=function(a){c.bind("ready",a)};this.repaint=function(a,b,c){if("object"==typeof a)for(var d=
0;d<a.length;d++)U(k(a),b,c);else U(k(a),b,c)};this.repaintEverything=function(){for(var a in m)U(k(a),null,null)};this.removeAllEndpoints=function(a){a=x(a,"id");var b=m[a];if(b)for(var e=0;e<b.length;e++)c.deleteEndpoint(b[e]);m[a]=[]};this.removeEveryEndpoint=this.deleteEveryEndpoint;this.removeEndpoint=function(a,b){c.deleteEndpoint(b)};var ha={};this.registerListener=function(a,b,c){d.CurrentLibrary.bind(a,b,c);W(ha,b,{el:a,event:b,listener:c})};this.unregisterListener=function(a,b,c){d.CurrentLibrary.unbind(a,
b,c);P(ha,function(a){return a.type==b&&a.listener==c})};this.reset=function(){c.deleteEveryEndpoint();c.unbind();na={};oa={};pa={};ga={};qa={};Ka={};ra={};sa={};for(var a in ha)for(var b=0;b<ha[a].length;b++){var e=ha[a][b];d.CurrentLibrary.unbind(e.el,e.event,e.listener)}ha={};c.anchorManager.reset();jsPlumbAdapter.headless||c.dragManager.reset()};this.setDefaultScope=function(a){ua=a};this.setDraggable=function(a,b){return Oa(a,function(a,c){H[c]=b;d.CurrentLibrary.isDragSupported(a)&&d.CurrentLibrary.setDraggable(a,
b)})};this.setId=function(a,b,e){var h=a.constructor==String?a:c.getId(a),f=c.getConnections({source:h,scope:"*"},!0),g=c.getConnections({target:h,scope:"*"},!0);b=""+b;e||(a=d.CurrentLibrary.getElementObject(h),d.CurrentLibrary.setAttribute(a,"id",b));a=d.CurrentLibrary.getElementObject(b);m[b]=m[h]||[];for(e=0;e<m[b].length;e++)m[b][e].elementId=b,m[b][e].element=a,m[b][e].anchor.elementId=b;delete m[h];c.anchorManager.changeId(h,b);h=function(c,e,d){for(var h=0;h<c.length;h++)c[h].endpoints[e].elementId=
b,c[h].endpoints[e].element=a,c[h][d+"Id"]=b,c[h][d]=a};h(f,0,"source");h(g,1,"target")};this.setIdChanged=function(a,b){c.setId(a,b,!0)};this.setDebugLog=function(a){q=a};this.setRepaintFunction=function(a){};var va=!1;this.setSuspendDrawing=function(a,b){va=a;b&&c.repaintEverything()};this.isSuspendDrawing=function(){return va};this.CANVAS="canvas";this.SVG="svg";this.VML="vml";this.setRenderMode=function(a){return Z=jsPlumbAdapter.setRenderMode(a)};this.getRenderMode=function(){return Z};this.show=
function(a,b){Ua(a,"block",b)};this.sizeCanvas=function(a,b,c,d,f){a&&(a.style.height=f+"px",a.height=f,a.style.width=d+"px",a.width=d,a.style.left=b+"px",a.style.top=c+"px")};this.getTestHarness=function(){return{endpointsByElement:m,endpointCount:function(a){return(a=m[a])?a.length:0},connectionCount:function(a){a=a||ua;return(a=N[a])?a.length:0},getId:B,makeAnchor:self.makeAnchor,makeDynamicAnchor:self.makeDynamicAnchor}};this.toggleVisible=this.toggle=l;this.toggleDraggable=function(a){return Oa(a,
function(a,c){var h=null==H[c]?!1:H[c],h=!h;H[c]=h;d.CurrentLibrary.setDraggable(a,h);return h})};this.unload=function(){};this.wrap=O;this.addListener=this.bind;var Ca=function(a,b){var c=null;"svg"===b.tagName.toLowerCase()&&b.parentNode?c=b.parentNode:b.offsetParent&&(c=b.offsetParent);if(null!=c){var h="body"===c.tagName.toLowerCase()?{left:0,top:0}:d.CurrentLibrary.getOffset(k(c)),c="body"===c.tagName.toLowerCase()?{left:0,top:0}:{left:c.scrollLeft,top:c.scrollTop};a[0]=a[0]-h.left+c.left;a[1]=
a[1]-h.top+c.top}return a},za=function(a){var b=this;this.x=a.x||0;this.y=a.y||0;this.elementId=a.elementId;var c=a.orientation||[0,0],d=null;this.offsets=a.offsets||[0,0];b.timestamp=null;this.compute=function(a){var c=a.xy,e=a.wh,f=a.element;if((a=a.timestamp)&&a===b.timestamp)return d;d=[c[0]+b.x*e[0]+b.offsets[0],c[1]+b.y*e[1]+b.offsets[1]];d=Ca(d,f.canvas);b.timestamp=a;return d};this.getOrientation=function(a){return c};this.equals=function(a){if(!a)return!1;var b=a.getOrientation(),c=this.getOrientation();
return this.x==a.x&&this.y==a.y&&this.offsets[0]==a.offsets[0]&&this.offsets[1]==a.offsets[1]&&c[0]==b[0]&&c[1]==b[1]};this.getCurrentLocation=function(){return d}},ab=function(a){var b=a.reference,c=Ea(k(a.referenceCanvas)),d=null,f=null;this.y=this.x=0;this.isFloating=!0;this.compute=function(a){var b=a.xy,b=[b[0]+c[0]/2,b[1]+c[1]/2];return f=Ca(b,a.element.canvas)};this.getOrientation=function(a){if(d)return d;a=b.getOrientation(a);return[-0*Math.abs(a[0]),-0*Math.abs(a[1])]};this.over=function(a){d=
a.getOrientation()};this.out=function(){d=null};this.getCurrentLocation=function(){return f}},ya=function(a,b,d){this.isDynamic=this.isSelective=!0;for(var f=[],l=this,g=function(a){return a.constructor==za?a:c.makeAnchor(a,d,c)},k=0;k<a.length;k++)f[k]=g(a[k]);this.addAnchor=function(a){f.push(g(a))};this.getAnchors=function(){return f};this.locked=!1;var p=0<f.length?f[0]:null,l=this,m=b||function(a,b,c,d,e){var f=c[0]+d[0]/2;c=c[1]+d[1]/2;d=-1;for(var h=Infinity,g=0;g<e.length;g++){var l;l=e[g];
var n=c,p=a[1]+l.y*b[1];l=Math.sqrt(Math.pow(f-(a[0]+l.x*b[0]),2)+Math.pow(n-p,2));l<h&&(d=g+0,h=l)}return e[d]};this.compute=function(a){var b=a.xy,c=a.wh,d=a.txy,e=a.twh;if(l.locked||null==d||null==e)return p.compute(a);a.timestamp=null;p=m(b,c,d,e,f);l.x=p.x;l.y=p.y;return p.compute(a)};this.getCurrentLocation=function(){return null!=p?p.getCurrentLocation():null};this.getOrientation=function(a){return null!=p?p.getOrientation(a):[0,0]};this.over=function(a){null!=p&&p.over(a)};this.out=function(){null!=
p&&p.out()}},bb={},Ma={},cb={},kb=function(a,b,c,d){if(a===b)return{orientation:"identity",a:["top","top"]};a=Math.atan2(d.centery-c.centery,d.centerx-c.centerx);b=Math.atan2(c.centery-d.centery,c.centerx-d.centerx);var f=c.left<=d.left&&c.right>=d.left||c.left<=d.right&&c.right>=d.right||c.left<=d.left&&c.right>=d.right||d.left<=c.left&&d.right>=c.right,g=c.top<=d.top&&c.bottom>=d.top||c.top<=d.bottom&&c.bottom>=d.bottom||c.top<=d.top&&c.bottom>=d.bottom||d.top<=c.top&&d.bottom>=c.bottom;if(f||g)return f?
{orientation:"horizontal",a:c.top<d.top?["bottom","top"]:["top","bottom"],theta:a,theta2:b}:{orientation:"vertical",a:c.left<d.left?["right","left"]:["left","right"],theta:a,theta2:b};f=null;d.left>c.left&&d.top>c.top?f=["right","top"]:d.left>c.left&&c.top>d.top?f=["top","left"]:d.left<c.left&&d.top<c.top?f=["top","right"]:d.left<c.left&&d.top>c.top&&(f=["left","top"]);return{orientation:"diagonal",a:f,theta:a,theta2:b}},lb=function(a,b,c,d,f,g,l){a=[];for(var p=b[f?0:1]/(d.length+1),k=0;k<d.length;k++){var m=
(k+1)*p,ea=g*b[f?1:0];l&&(m=b[f?0:1]-m);var q=f?m:ea,m=f?ea:m;a.push([c[0]+q,c[1]+m,q/b[0],m/b[1],d[k][1],d[k][2]])}return a};l=function(a){return function(b,c){var d=!0,d=a?b[0][0]<c[0][0]?!0:b[0][1]>c[0][1]:b[0][0]>c[0][0]?!0:b[0][1]>c[0][1];return!1===d?-1:1}};var mb={top:function(a,b){return a[0]>b[0]?1:-1},right:l(!0),bottom:l(!0),left:function(a,b){return(0>a[0][0]?-Math.PI-a[0][0]:Math.PI-a[0][0])>(0>b[0][0]?-Math.PI-b[0][0]:Math.PI-b[0][0])?1:a[0][1]>b[0][1]?1:-1}},nb=function(a,b){var c=
G[a],d=A[a],f=function(b,c,d,e,f,h,l){if(0<e.length)for(e=e.sort(mb[b]),b=lb(b,c,d,e,f,h,"right"===b||"top"===b),c=function(a,b){var c=Ca([b[0],b[1]],a.canvas);Ma[a.id]=[c[0],c[1],b[2],b[3]];cb[a.id]=l},d=0;d<b.length;d++)f=b[d][4],h=f.endpoints[1].elementId===a,f.endpoints[0].elementId===a?c(f.endpoints[0],b[d]):h&&c(f.endpoints[1],b[d])};f("bottom",c,[d.left,d.top],b.bottom,!0,1,[0,1]);f("top",c,[d.left,d.top],b.top,!0,0,[0,-1]);f("left",c,[d.left,d.top],b.left,!1,0,[-1,0]);f("right",c,[d.left,
d.top],b.right,!1,1,[1,0])};c.anchorManager=new function(){var a={},b={},e=this,f={};this.reset=function(){a={};b={};f={}};this.newConnection=function(a){var c=a.sourceId,e=a.targetId,f=a.endpoints,l=!0,h=function(a,g,h,k,m){c==e&&h.isContinuous&&(d.CurrentLibrary.removeElement(f[1].canvas),l=!1);W(b,k,[m,g,h.constructor==ya])};h(0,f[0],f[0].anchor,e,a);l&&h(1,f[1],f[1].anchor,c,a)};this.connectionDetached=function(a){a=a.connection||a;var c=a.targetId,d=a.endpoints,l=function(a,c,d,e,f){d.constructor!=
ab&&P(b[e],function(a){return a[0].id==f.id})};l(1,d[1],d[1].anchor,a.sourceId,a);l(0,d[0],d[0].anchor,c,a);var c=a.sourceId,d=a.targetId,l=a.endpoints[1].id,k=function(a,b){if(a){var c=function(a){return a[4]==b};P(a.top,c);P(a.left,c);P(a.bottom,c);P(a.right,c)}};k(f[c],a.endpoints[0].id);k(f[d],l);e.redraw(c);e.redraw(d)};this.add=function(b,c){W(a,c,b)};this.changeId=function(c,d){b[d]=b[c];a[d]=a[c];delete b[c];delete a[c]};this.getConnectionsFor=function(a){return b[a]||[]};this.getEndpointsFor=
function(b){return a[b]||[]};this.deleteEndpoint=function(b){P(a[b.elementId],function(a){return a.id==b.id})};this.clearFor=function(b){delete a[b];a[b]=[]};var l=function(a,b,c,d,e,f,l,h,k,m,r,s){m=-1;var v=d.endpoints[l],n=v.id;b=[[b,c],d,e,f,n];var q=a[k],F=v._continuousAnchorEdge?a[v._continuousAnchorEdge]:null;if(F&&(a=Da(F,function(a){return a[4]==n}),-1!=a)){F.splice(a,1);for(var I=0;I<F.length;I++)L(r,F[I][1],function(a){return a.id==F[I][1].id}),L(s,F[I][1].endpoints[l],function(a){return a.id==
F[I][1].endpoints[l].id})}for(I=0;I<q.length;I++)1==l&&q[I][3]===f&&-1==m&&(m=I),L(r,q[I][1],function(a){return a.id==q[I][1].id}),L(s,q[I][1].endpoints[l],function(a){return a.id==q[I][1].endpoints[l].id});q.splice(h?-1!=m?m:0:q.length,0,b);v._continuousAnchorEdge=k};this.redraw=function(c,d,e,k){if(!va){var m=a[c]||[],q=b[c]||[],w=[],D=[],y=[];e=e||ja();k=k||{left:0,top:0};d&&(d={left:d.left+k.left,top:d.top+k.top});J({elId:c,offset:d,recalc:!1,timestamp:e});d=A[c];k=G[c];for(var x={},u=0;u<q.length;u++){var s=
q[u][0],v=s.sourceId,n=s.targetId,aa=s.endpoints[0].anchor.isContinuous,F=s.endpoints[1].anchor.isContinuous;if(aa||F){var I=v+"_"+n,t=x[I],K=s.sourceId==c?1:0;aa&&!f[v]&&(f[v]={top:[],right:[],bottom:[],left:[]});F&&!f[n]&&(f[n]={top:[],right:[],bottom:[],left:[]});c!=n&&J({elId:n,timestamp:e});c!=v&&J({elId:v,timestamp:e});var B=Va(n),C=Va(v);n==v&&(aa||F)?l(f[v],-Math.PI/2,0,s,!1,n,0,!1,"top",v,w,D):(t||(t=kb(v,n,C.o,B.o),x[I]=t),aa&&l(f[v],t.theta,0,s,!1,n,0,!1,t.a[0],v,w,D),F&&l(f[n],t.theta2,
-1,s,!0,v,1,!0,t.a[1],n,w,D));aa&&L(y,v,function(a){return a===v});F&&L(y,n,function(a){return a===n});L(w,s,function(a){return a.id==s.id});(aa&&0==K||F&&1==K)&&L(D,s.endpoints[K],function(a){return a.id==s.endpoints[K].id})}}for(u=0;u<m.length;u++)0==m[u].connections.length&&m[u].anchor.isContinuous&&(f[c]||(f[c]={top:[],right:[],bottom:[],left:[]}),l(f[c],-Math.PI/2,0,{endpoints:[m[u],m[u]],paint:function(){}},!1,c,0,!1,"top",c,w,D),L(y,c,function(a){return a===c}));for(u=0;u<y.length;u++)nb(y[u],
f[y[u]]);for(u=0;u<m.length;u++)m[u].paint({timestamp:e,offset:d,dimensions:k});for(u=0;u<D.length;u++)D[u].paint({timestamp:e,offset:d,dimensions:k});for(u=0;u<q.length;u++){var z=q[u][1];if(z.anchor.constructor==ya){z.paint({elementWithPrecedence:c});L(w,q[u][0],function(a){return a.id==q[u][0].id});for(var E=0;E<z.connections.length;E++)z.connections[E]!==q[u][0]&&L(w,z.connections[E],function(a){return a.id==z.connections[E].id})}else z.anchor.constructor==za&&L(w,q[u][0],function(a){return a.id==
q[u][0].id})}(m=ba[c])&&m.paint({timestamp:e,recalc:!1,elId:c});for(u=0;u<w.length;u++)w[u].paint({elId:c,timestamp:e,recalc:!1})}};this.rehomeEndpoint=function(b,d){for(var f=a[b]||[],l=c.getId(d),h=0;h<f.length;h++)e.add(f[h],l);f.splice(0,f.length)}};c.continuousAnchorFactory={get:function(a){var b=bb[a.elementId];b||(b={type:"Continuous",compute:function(a){return Ma[a.element.id]||[0,0]},getCurrentLocation:function(a){return Ma[a.id]||[0,0]},getOrientation:function(a){return cb[a.id]||[0,0]},
isDynamic:!0,isContinuous:!0},bb[a.elementId]=b);return b}};jsPlumbAdapter.headless||(c.dragManager=jsPlumbAdapter.getDragManager(c));var hb=function(a){var b=this,e=!0,f,l;b.idPrefix="_jsplumb_c_";b.defaultLabelLocation=0.5;b.defaultOverlayKeys=["Overlays","ConnectionOverlays"];this.parent=a.parent;Pa.apply(this,arguments);this.isVisible=function(){return e};this.setVisible=function(a){e=a;b[a?"showOverlays":"hideOverlays"]();b.connector&&b.connector.canvas&&(b.connector.canvas.style.display=a?"block":
"none");b.repaint()};this.getTypeDescriptor=function(){return"connection"};this.getDefaultType=function(){return{parameters:{},scope:null,detachable:b._jsPlumb.Defaults.ConnectionsDetachable,paintStyle:b._jsPlumb.Defaults.PaintStyle||d.Defaults.PaintStyle,connector:b._jsPlumb.Defaults.Connector||d.Defaults.Connector,hoverPaintStyle:b._jsPlumb.Defaults.HoverPaintStyle||d.Defaults.HoverPaintStyle,overlays:b._jsPlumb.Defaults.ConnectorOverlays||d.Defaults.ConnectorOverlays}};var g=this.applyType;this.applyType=
function(a){g(a);null!=a.detachable&&b.setDetachable(a.detachable);a.scope&&(b.scope=a.scope);b.setConnector(a.connector)};l=b.setHover;b.setHover=function(a){var e=c.ConnectorZIndex||d.Defaults.ConnectorZIndex;e&&b.connector.setZIndex(e+(a?1:0));b.connector.setHover.apply(b.connector,arguments);l.apply(b,arguments)};f=function(a){b.setHover(a,!1)};this.setConnector=function(e,l){null!=b.connector&&ma(b.connector.getDisplayElements(),b.parent);var n={_jsPlumb:b._jsPlumb,parent:a.parent,cssClass:a.cssClass,
container:a.container,tooltip:b.tooltip};ia(e)?this.connector=new d.Connectors[Z][e](n):Y(e)&&(this.connector=1==e.length?new d.Connectors[Z][e[0]](n):new d.Connectors[Z][e[0]](d.extend(e[1],n)));b.canvas=b.connector.canvas;Qa(b.connector,b,f);(n=c.ConnectorZIndex||d.Defaults.ConnectorZIndex)&&b.connector.setZIndex(n);l||b.repaint()};this.source=k(a.source);this.target=k(a.target);a.sourceEndpoint&&(this.source=a.sourceEndpoint.endpointWillMoveTo||a.sourceEndpoint.getElement());a.targetEndpoint&&
(this.target=a.targetEndpoint.getElement());b.previousConnection=a.previousConnection;this.sourceId=x(this.source,"id");this.targetId=x(this.target,"id");this.scope=a.scope;this.endpoints=[];this.endpointStyles=[];var q=function(a,b){return a?c.makeAnchor(a,b,c):null},p=function(a,e,f,l,h,k,m){var g;a?(b.endpoints[e]=a,a.addConnection(b)):(f.endpoints||(f.endpoints=[null,null]),a=f.endpoints[e]||f.endpoint||c.Defaults.Endpoints[e]||d.Defaults.Endpoints[e]||c.Defaults.Endpoint||d.Defaults.Endpoint,
f.endpointStyles||(f.endpointStyles=[null,null]),f.endpointHoverStyles||(f.endpointHoverStyles=[null,null]),g=f.endpointStyles[e]||f.endpointStyle||c.Defaults.EndpointStyles[e]||d.Defaults.EndpointStyles[e]||c.Defaults.EndpointStyle||d.Defaults.EndpointStyle,null==g.fillStyle&&null!=k&&(g.fillStyle=k.strokeStyle),null==g.outlineColor&&null!=k&&(g.outlineColor=k.outlineColor),null==g.outlineWidth&&null!=k&&(g.outlineWidth=k.outlineWidth),k=f.endpointHoverStyles[e]||f.endpointHoverStyle||c.Defaults.EndpointHoverStyles[e]||
d.Defaults.EndpointHoverStyles[e]||c.Defaults.EndpointHoverStyle||d.Defaults.EndpointHoverStyle,null!=m&&(null==k&&(k={}),null==k.fillStyle&&(k.fillStyle=m.strokeStyle)),h=f.anchors?f.anchors[e]:f.anchor?f.anchor:q(c.Defaults.Anchors[e],h)||q(d.Defaults.Anchors[e],h)||q(c.Defaults.Anchor,h)||q(d.Defaults.Anchor,h),g=wa({paintStyle:g,hoverPaintStyle:k,endpoint:a,connections:[b],uuid:f.uuids?f.uuids[e]:null,anchor:h,source:l,scope:f.scope,container:f.container,reattach:f.reattach,detachable:f.detachable}),
b.endpoints[e]=g,!1===f.drawEndpoints&&g.setVisible(!1,!0,!0));return g},w=p(a.sourceEndpoint,0,a,b.source,b.sourceId,a.paintStyle,a.hoverPaintStyle);w&&W(m,this.sourceId,w);(p=p(a.targetEndpoint,1,a,b.target,b.targetId,a.paintStyle,a.hoverPaintStyle))&&W(m,this.targetId,p);this.scope||(this.scope=this.endpoints[0].scope);a.deleteEndpointsOnDetach&&(b.endpointsToDeleteOnDetach=[w,p]);b.setConnector(this.endpoints[0].connector||this.endpoints[1].connector||a.connector||c.Defaults.Connector||d.Defaults.Connector,
!0);this.setPaintStyle(this.endpoints[0].connectorStyle||this.endpoints[1].connectorStyle||a.paintStyle||c.Defaults.PaintStyle||d.Defaults.PaintStyle,!0);this.setHoverPaintStyle(this.endpoints[0].connectorHoverStyle||this.endpoints[1].connectorHoverStyle||a.hoverPaintStyle||c.Defaults.HoverPaintStyle||d.Defaults.HoverPaintStyle,!0);this.paintStyleInUse=this.getPaintStyle();J({elId:this.sourceId});J({elId:this.targetId});var w=A[this.sourceId],p=G[this.sourceId],t=A[this.targetId],y=G[this.targetId],
z=ja(),D=this.endpoints[0].anchor.compute({xy:[w.left,w.top],wh:p,element:this.endpoints[0],elementId:this.endpoints[0].elementId,txy:[t.left,t.top],twh:y,tElement:this.endpoints[1],timestamp:z});this.endpoints[0].paint({anchorLoc:D,timestamp:z});D=this.endpoints[1].anchor.compute({xy:[t.left,t.top],wh:y,element:this.endpoints[1],elementId:this.endpoints[1].elementId,txy:[w.left,w.top],twh:p,tElement:this.endpoints[0],timestamp:z});this.endpoints[1].paint({anchorLoc:D,timestamp:z});var B=c.Defaults.ConnectionsDetachable;
!1===a.detachable&&(B=!1);!1===b.endpoints[0].connectionsDetachable&&(B=!1);!1===b.endpoints[1].connectionsDetachable&&(B=!1);this.isDetachable=function(){return!0===B};this.setDetachable=function(a){B=!0===a};var C=a.cost||b.endpoints[0].getConnectionCost();b.getCost=function(){return C};b.setCost=function(a){C=a};var u=!1!==a.bidirectional;null==a.bidirectional&&(u=b.endpoints[0].areConnectionsBidirectional());b.isBidirectional=function(){return u};w=d.extend({},this.endpoints[0].getParameters());
d.extend(w,this.endpoints[1].getParameters());d.extend(w,b.getParameters());b.setParameters(w);this.getAttachedElements=function(){return b.endpoints};this.moveParent=function(a){var c=d.CurrentLibrary,e=c.getParent(b.connector.canvas);b.connector.bgCanvas&&(c.removeElement(b.connector.bgCanvas,e),c.appendElement(b.connector.bgCanvas,a));c.removeElement(b.connector.canvas,e);c.appendElement(b.connector.canvas,a);for(var f=0;f<b.overlays.length;f++)b.overlays[f].isAppendedAtTopLevel&&(c.removeElement(b.overlays[f].canvas,
e),c.appendElement(b.overlays[f].canvas,a),b.overlays[f].reattachListeners&&b.overlays[f].reattachListeners(b.connector));b.connector.reattachListeners&&b.connector.reattachListeners()};this.paint=function(a){if(e){a=a||{};var c=a.timestamp,d=this.targetId;a=J({elId:a.elId,offset:a.ui,recalc:a.recalc,timestamp:c});for(var c=J({elId:d,timestamp:c}),d=this.endpoints[0],f=this.endpoints[1],d=d.anchor.getCurrentLocation(d),l=f.anchor.getCurrentLocation(f),h=0,f=0;f<b.overlays.length;f++){var k=b.overlays[f];
k.isVisible()&&(h=Math.max(h,k.computeMaxSize()))}a=this.connector.compute(d,l,this.endpoints[0],this.endpoints[1],this.endpoints[0].anchor,this.endpoints[1].anchor,b.paintStyleInUse.lineWidth,h,a,c);b.connector.paint(a,b.paintStyleInUse);for(f=0;f<b.overlays.length;f++)k=b.overlays[f],k.isVisible&&(b.overlayPlacements[f]=k.draw(b.connector,b.paintStyleInUse,a))}};this.repaint=function(a){a=a||{};this.paint({elId:this.sourceId,recalc:!1!==a.recalc,timestamp:a.timestamp})};(w=a.type||b.endpoints[0].connectionType||
b.endpoints[1].connectionType)&&b.setType(w)},ob=function(a){var b=!1;return{drag:function(){if(b)return b=!1,!0;var c=d.CurrentLibrary.getUIPosition(arguments),f=a.element;f&&(d.CurrentLibrary.setOffset(f,c),U(k(f),c))},stopDrag:function(){b=!0}}},Ha=function(a){var b=this;b.idPrefix="_jsplumb_e_";b.defaultLabelLocation=[0.5,0.5];b.defaultOverlayKeys=["Overlays","EndpointOverlays"];this.parent=a.parent;Pa.apply(this,arguments);a=a||{};this.getTypeDescriptor=function(){return"endpoint"};this.getDefaultType=
function(){return{parameters:{},scope:null,maxConnections:b._jsPlumb.Defaults.MaxConnections,paintStyle:b._jsPlumb.Defaults.EndpointStyle||d.Defaults.EndpointStyle,endpoint:b._jsPlumb.Defaults.Endpoint||d.Defaults.Endpoint,hoverPaintStyle:b._jsPlumb.Defaults.EndpointHoverStyle||d.Defaults.EndpointHoverStyle,overlays:b._jsPlumb.Defaults.EndpointOverlays||d.Defaults.EndpointOverlays,connectorStyle:a.connectorStyle,connectorHoverStyle:a.connectorHoverStyle,connectorClass:a.connectorClass,connectorHoverClass:a.connectorHoverClass,
connectorOverlays:a.connectorOverlays,connector:a.connector,connectorTooltip:a.connectorTooltip}};var e=this.applyType;this.applyType=function(a){e(a);null!=a.maxConnections&&(u=a.maxConnections);a.scope&&(b.scope=a.scope);b.connectorStyle=a.connectorStyle;b.connectorHoverStyle=a.connectorHoverStyle;b.connectorOverlays=a.connectorOverlays;b.connector=a.connector;b.connectorTooltip=a.connectorTooltip;b.connectionType=a.connectionType;b.connectorClass=a.connectorClass;b.connectorHoverClass=a.connectorHoverClass};
var f=!0,l=!1!==a.enabled;this.isVisible=function(){return f};this.setVisible=function(a,c,d){f=a;b.canvas&&(b.canvas.style.display=a?"block":"none");b[a?"showOverlays":"hideOverlays"]();if(!c)for(c=0;c<b.connections.length;c++)if(b.connections[c].setVisible(a),!d){var e=b===b.connections[c].endpoints[0]?1:0;1==b.connections[c].endpoints[e].connections.length&&b.connections[c].endpoints[e].setVisible(a,!0,!0)}};this.isEnabled=function(){return l};this.setEnabled=function(a){l=a};var g=a.source,q=
a.uuid,p=null,w=null;q&&(V[q]=b);var t=x(g,"id");this.elementId=t;this.element=g;var y=a.connectionCost;this.getConnectionCost=function(){return y};this.setConnectionCost=function(a){y=a};var z=!1===a.connectionsBidirectional?!1:!0;this.areConnectionsBidirectional=function(){return z};this.setConnectionsBidirectional=function(a){z=a};b.anchor=a.anchor?c.makeAnchor(a.anchor,t,c):a.anchors?c.makeAnchor(a.anchors,t,c):c.makeAnchor("TopCenter",t,c);a._transient||c.anchorManager.add(b,t);var D=null;this.setEndpoint=
function(c){var e={_jsPlumb:b._jsPlumb,parent:a.parent,container:a.container,tooltip:a.tooltip,connectorTooltip:a.connectorTooltip,endpoint:b};ia(c)?D=new d.Endpoints[Z][c](e):Y(c)?(e=d.extend(c[1],e),D=new d.Endpoints[Z][c[0]](e)):D=c.clone();var f=d.extend({},e);D.clone=function(){var a={};D.constructor.apply(a,[f]);return a};b.endpoint=D;b.type=b.endpoint.type};this.setEndpoint(a.endpoint||c.Defaults.Endpoint||d.Defaults.Endpoint||"Dot");var C=b.setHover;b.setHover=function(){b.endpoint.setHover.apply(b.endpoint,
arguments);C.apply(b,arguments)};Qa(b.endpoint,b,function(a){0<b.connections.length?b.connections[0].setHover(a,!1):b.setHover(a)});this.setPaintStyle(a.paintStyle||a.style||c.Defaults.EndpointStyle||d.Defaults.EndpointStyle,!0);this.setHoverPaintStyle(a.hoverPaintStyle||c.Defaults.EndpointHoverStyle||d.Defaults.EndpointHoverStyle,!0);this.paintStyleInUse=this.getPaintStyle();var E=this.getPaintStyle();this.connectorStyle=a.connectorStyle;this.connectorHoverStyle=a.connectorHoverStyle;this.connectorOverlays=
a.connectorOverlays;this.connector=a.connector;this.connectorTooltip=a.connectorTooltip;this.connectorClass=a.connectorClass;this.connectorHoverClass=a.connectorHoverClass;this.isSource=a.isSource||!1;this.isTarget=a.isTarget||!1;var u=a.maxConnections||c.Defaults.MaxConnections;this.getAttachedElements=function(){return b.connections};this.canvas=this.endpoint.canvas;this.connections=a.connections||[];this.scope=a.scope||ua;this.connectionType=a.connectionType;this.timestamp=null;b.isReattach=a.reattach||
!1;b.connectionsDetachable=c.Defaults.ConnectionsDetachable;if(!1===a.connectionsDetachable||!1===a.detachable)b.connectionsDetachable=!1;var s=a.dragAllowedWhenFull||!0;a.onMaxConnections&&b.bind("maxConnections",a.onMaxConnections);this.computeAnchor=function(a){return b.anchor.compute(a)};this.addConnection=function(a){b.connections.push(a)};this.detach=function(a,d,e,f,l){var h=Da(b.connections,function(b){return b.id==a.id}),k=!1;f=!1!==f;if(0<=h&&(e||a._forceDetach||a.isDetachable()||a.isDetachAllowed(a))){var g=
a.endpoints[0]==b?a.endpoints[1]:a.endpoints[0];if(e||a._forceDetach||b.isDetachAllowed(a)){b.connections.splice(h,1);if(!d&&(g.detach(a,!0,e),a.endpointsToDeleteOnDetach))for(e=0;e<a.endpointsToDeleteOnDetach.length;e++)(h=a.endpointsToDeleteOnDetach[e])&&0==h.connections.length&&c.deleteEndpoint(h);ma(a.connector.getDisplayElements(),a.parent);P(N[a.scope],function(b){return b.id==a.id});k=!0;Wa(a,!d&&f,l)}}return k};this.detachAll=function(a,c){for(;0<b.connections.length;)b.detach(b.connections[0],
!1,!0,a,c)};this.detachFrom=function(a,c,d){for(var e=[],f=0;f<b.connections.length;f++)b.connections[f].endpoints[1]!=a&&b.connections[f].endpoints[0]!=a||e.push(b.connections[f]);for(f=0;f<e.length;f++)b.detach(e[f],!1,!0,c,d)&&e[f].setHover(!1,!1)};this.detachFromConnection=function(a){var c=Da(b.connections,function(b){return b.id==a.id});0<=c&&b.connections.splice(c,1)};this.getElement=function(){return g};this.setElement=function(a,c){var d=B(a);P(m[b.elementId],function(a){return a.id==b.id});
g=k(a);t=B(g);b.elementId=t;var e=Sa({source:d,container:c}),f=Q.getParent(b.canvas);Q.removeElement(b.canvas,f);Q.appendElement(b.canvas,e);for(f=0;f<b.connections.length;f++)b.connections[f].moveParent(e),b.connections[f].sourceId=t,b.connections[f].source=g;W(m,d,b)};this.getUuid=function(){return q};this.makeInPlaceCopy=function(){var a=b.anchor.getCurrentLocation(b),c=b.anchor.getOrientation(b);return wa({anchor:{compute:function(){return[a[0],a[1]]},getCurrentLocation:function(){return[a[0],
a[1]]},getOrientation:function(){return c}},source:g,paintStyle:this.getPaintStyle(),endpoint:D,_transient:!0,scope:b.scope})};this.isConnectedTo=function(a){var c=!1;if(a)for(var d=0;d<b.connections.length;d++)if(b.connections[d].endpoints[1]==a){c=!0;break}return c};this.isFloating=function(){return null!=p};this.connectorSelector=function(){var a=b.connections[0];return b.isTarget&&a?a:b.connections.length<u||-1==u?null:a};this.isFull=function(){return!(b.isFloating()||1>u||b.connections.length<
u)};this.setDragAllowedWhenFull=function(a){s=a};this.setStyle=b.setPaintStyle;this.equals=function(a){return this.anchor.equals(a.anchor)};this.repaint=this.paint=function(a){a=a||{};var c=a.timestamp,d=!1!==a.recalc;if(!c||b.timestamp!==c){J({elId:t,timestamp:c,recalc:d});var f=a.offset||A[t];if(f){var e=a.anchorPoint,l=a.connectorPaintStyle;if(null==e){e=a.dimensions||G[t];if(null==f||null==e)J({elId:t,timestamp:c}),f=A[t],e=G[t];f={xy:[f.left,f.top],wh:e,element:b,timestamp:c};if(d&&b.anchor.isDynamic&&
0<b.connections.length){a=a.elementWithPrecedence;d=0;if(null!=a)for(e=0;e<b.connections.length;e++)if(b.connections[e].sourceId==a||b.connections[e].targetId==a){d=e;break}a=b.connections[d];var d=a.endpoints[0]==b?1:0,h=0==d?a.sourceId:a.targetId,e=A[h],h=G[h];f.txy=[e.left,e.top];f.twh=h;f.tElement=a.endpoints[d]}e=b.anchor.compute(f)}l=D.compute(e,b.anchor.getOrientation(b),b.paintStyleInUse,l||b.paintStyleInUse);D.paint(l,b.paintStyleInUse,b.anchor);b.timestamp=c;for(c=0;c<b.overlays.length;c++)f=
b.overlays[c],f.isVisible&&(b.overlayPlacements[c]=f.draw(b.endpoint,b.paintStyleInUse,l))}}};this.removeConnection=this.detach;if(d.CurrentLibrary.isDragSupported(g)){var v={id:null,element:null},n=null,H=!1,F=null,I=ob(v),Q=d.CurrentLibrary,K=a.dragOptions||{},L=d.extend({},Q.defaultDragOptions),M=Q.dragEvents.start,R=Q.dragEvents.stop,S=Q.dragEvents.drag,K=d.extend(L,K);K.scope=K.scope||b.scope;K[M]=O(K[M],function(){n=b.connectorSelector();var e=!0;b.isEnabled()||(e=!1);null!=n||a.isSource||(e=
!1);a.isSource&&b.isFull()&&!s&&(e=!1);null==n||n.isDetachable()||(e=!1);if(!1===e)return d.CurrentLibrary.stopDrag&&d.CurrentLibrary.stopDrag(),I.stopDrag(),!1;n&&!b.isFull()&&a.isSource&&(n=null);J({elId:t});w=b.makeInPlaceCopy();w.paint();var e=v,f=b.parent,l=document.createElement("div");l.style.position="absolute";var h=k(l);ta(l,f);f=B(h);J({elId:f});e.id=f;e.element=h;e=k(w.canvas);e=d.CurrentLibrary.getOffset(e);e=Ca([e.left,e.top],w.canvas);d.CurrentLibrary.setOffset(v.element,{left:e[0],
top:e[1]});b.parentAnchor&&(b.anchor=c.makeAnchor(b.parentAnchor,b.elementId,c));e=k(b.canvas);h=v.id;d.CurrentLibrary.setAttribute(k(e),"dragId",h);e=k(b.canvas);h=t;d.CurrentLibrary.setAttribute(k(e),"elId",h);a.proxy&&b.setPaintStyle(a.proxy.paintStyle);e=b.getPaintStyle();h=D;f=v.element;l=new ab({reference:b.anchor,referenceCanvas:b.canvas});p=wa({paintStyle:e,endpoint:h,anchor:l,source:f,scope:"__floating"});null==n?(b.anchor.locked=!0,b.setHover(!1,!1),n=Ra({sourceEndpoint:b,targetEndpoint:p,
source:b.endpointWillMoveTo||k(g),target:v.element,anchors:[b.anchor,p.anchor],paintStyle:a.connectorStyle,hoverPaintStyle:a.connectorHoverStyle,connector:a.connector,overlays:a.connectorOverlays,type:b.connectionType,cssClass:b.connectorClass,hoverClass:b.connectorHoverClass})):(H=!0,n.connector.setHover(!1,!1),U(k(w.canvas),!1,!0),e=n.endpoints[0].id==b.id?0:1,n.floatingAnchorIndex=e,b.detachFromConnection(n),h=k(b.canvas),f=d.CurrentLibrary.getDragScope(h),d.CurrentLibrary.setAttribute(k(h),"originalScope",
f),l=d.CurrentLibrary.getDropScope(h),d.CurrentLibrary.setDragScope(h,l),0==e?(F=[n.source,n.sourceId,T,f],n.source=v.element,n.sourceId=v.id):(F=[n.target,n.targetId,T,f],n.target=v.element,n.targetId=v.id),n.endpoints[0==e?1:0].anchor.locked=!0,n.suspendedEndpoint=n.endpoints[e],n.suspendedEndpoint.setHover(!1),n.endpoints[e]=p,c.fire("connectionDrag",n));ba[v.id]=n;p.addConnection(n);W(m,v.id,p);c.currentlyDragging=!0});K[S]=O(K[S],I.drag);K[R]=O(K[R],function(){var a=Q.getDropEvent(arguments);
c.currentlyDragging=!1;P(m[v.id],function(a){return a.id==p.id});ma([v.element[0],p.canvas],g);Ta(w.canvas,g);c.anchorManager.clearFor(v.id);var e=null==n.floatingAnchorIndex?1:n.floatingAnchorIndex;n.endpoints[0==e?1:0].anchor.locked=!1;b.setPaintStyle(E);if(n.endpoints[e]==p)if(H&&n.suspendedEndpoint){0==e?(n.source=F[0],n.sourceId=F[1]):(n.target=F[0],n.targetId=F[1]);d.CurrentLibrary.setDragScope(F[2],F[3]);n.endpoints[e]=n.suspendedEndpoint;if(b.isReattach||n._forceDetach||!n.endpoints[0==e?
1:0].detach(n,!1,!1,!0,a))n.setHover(!1),n.floatingAnchorIndex=null,n.suspendedEndpoint.addConnection(n),c.repaint(F[1]);n._forceDetach=null}else ma(n.connector.getDisplayElements(),b.parent),b.detachFromConnection(n);b.anchor.locked=!1;b.paint({recalc:!1});n.setHover(!1,!1);c.fire("connectionDragStop",n);w=n=null;delete m[p.elementId];p=p.anchor=null;c.currentlyDragging=!1});var T=k(b.canvas);d.CurrentLibrary.initDraggable(T,K,!0)}var U=function(e,f,l,h){if((a.isTarget||f)&&d.CurrentLibrary.isDropSupported(g)){f=
a.dropOptions||c.Defaults.DropOptions||d.Defaults.DropOptions;f=d.extend({},f);f.scope=f.scope||b.scope;var m=d.CurrentLibrary.dragEvents.drop,n=d.CurrentLibrary.dragEvents.over,p=d.CurrentLibrary.dragEvents.out;f[m]=O(f[m],function(){var a=d.CurrentLibrary.getDropEvent(arguments),e=k(d.CurrentLibrary.getDragObject(arguments)),f=x(e,"dragId");x(e,"elId");var l=x(e,"originalScope"),g=ba[f];if(null!=g){var m=null==g.floatingAnchorIndex?1:g.floatingAnchorIndex;l&&d.CurrentLibrary.setDragScope(e,l);e=
null!=h?h.isEnabled():!0;b.isFull()&&b.fire("maxConnections",{endpoint:b,connection:g,maxConnections:u},a);if(!b.isFull()&&(0!=m||b.isSource)&&(1!=m||b.isTarget)&&e){e=!0;g.suspendedEndpoint&&g.suspendedEndpoint.id!=b.id&&(0==m?(g.source=g.suspendedEndpoint.element,g.sourceId=g.suspendedEndpoint.elementId):(g.target=g.suspendedEndpoint.element,g.targetId=g.suspendedEndpoint.elementId),g.isDetachAllowed(g)&&g.endpoints[m].isDetachAllowed(g)&&g.suspendedEndpoint.isDetachAllowed(g)&&c.checkCondition("beforeDetach",
g)||(e=!1));0==m?(g.source=b.element,g.sourceId=b.elementId):(g.target=b.element,g.targetId=b.elementId);if(e&&b.isDropAllowed(g.sourceId,g.targetId,g.scope,g,b)){g.endpoints[m].detachFromConnection(g);g.suspendedEndpoint&&g.suspendedEndpoint.detachFromConnection(g);g.endpoints[m]=b;b.addConnection(g);var e=b.getParameters(),n;for(n in e)g.setParameter(n,e[n]);g.suspendedEndpoint?(n=g.suspendedEndpoint.getElement(),e=g.suspendedEndpoint.elementId,Wa({source:0==m?n:g.source,target:1==m?n:g.target,
sourceId:0==m?e:g.sourceId,targetId:1==m?e:g.targetId,sourceEndpoint:0==m?g.suspendedEndpoint:g.endpoints[0],targetEndpoint:1==m?g.suspendedEndpoint:g.endpoints[1],connection:g},!0,a)):e.draggable&&d.CurrentLibrary.initDraggable(b.element,K,!0);Ia(g,null,a)}else g.suspendedEndpoint&&(g.endpoints[m]=g.suspendedEndpoint,g.setHover(!1),g._forceDetach=!0,0==m?(g.source=g.suspendedEndpoint.element,g.sourceId=g.suspendedEndpoint.elementId):(g.target=g.suspendedEndpoint.element,g.targetId=g.suspendedEndpoint.elementId),
g.suspendedEndpoint.addConnection(g),g.endpoints[0].repaint(),g.repaint(),c.repaint(g.source.elementId),g._forceDetach=!1);g.floatingAnchorIndex=null}c.currentlyDragging=!1;delete ba[f]}});f[n]=O(f[n],function(){if(b.isTarget){var a=d.CurrentLibrary.getDragObject(arguments),a=x(k(a),"dragId"),a=ba[a];null!=a&&a.endpoints[null==a.floatingAnchorIndex?1:a.floatingAnchorIndex].anchor.over(b.anchor)}});f[p]=O(f[p],function(){if(b.isTarget){var a=d.CurrentLibrary.getDragObject(arguments),a=x(k(a),"dragId"),
a=ba[a];null!=a&&a.endpoints[null==a.floatingAnchorIndex?1:a.floatingAnchorIndex].anchor.out()}});d.CurrentLibrary.initDroppable(e,f,!0,l)}};U(k(b.canvas),!0,!(a._transient||b.anchor.isFloating),b);a.type&&b.setType(a.type);return b}},d=new ta;"undefined"!=typeof window&&(window.jsPlumb=d);d.getInstance=function(d){d=new ta(d);d.init();return d};var E=function(d,f,k,c,z,x){return function(t){t=t||{};var y=t.jsPlumbInstance.makeAnchor([d,f,k,c,0,0],t.elementId,t.jsPlumbInstance);y.type=z;x&&x(y,t);
return y}};d.Anchors.TopCenter=E(0.5,0,0,-1,"TopCenter");d.Anchors.BottomCenter=E(0.5,1,0,1,"BottomCenter");d.Anchors.LeftMiddle=E(0,0.5,-1,0,"LeftMiddle");d.Anchors.RightMiddle=E(1,0.5,1,0,"RightMiddle");d.Anchors.Center=E(0.5,0.5,0,0,"Center");d.Anchors.TopRight=E(1,0,0,-1,"TopRight");d.Anchors.BottomRight=E(1,1,0,1,"BottomRight");d.Anchors.TopLeft=E(0,0,0,-1,"TopLeft");d.Anchors.BottomLeft=E(0,1,0,1,"BottomLeft");d.Defaults.DynamicAnchors=function(d){return d.jsPlumbInstance.makeAnchors(["TopCenter",
"RightMiddle","BottomCenter","LeftMiddle"],d.elementId,d.jsPlumbInstance)};d.Anchors.AutoDefault=function(l){l=l.jsPlumbInstance.makeDynamicAnchor(d.Defaults.DynamicAnchors(l));l.type="AutoDefault";return l};d.Anchors.Assign=E(0,0,0,0,"Assign",function(d,f){var k=f.position||"Fixed";d.positionFinder=k.constructor==String?f.jsPlumbInstance.AnchorPositionFinders[k]:k;d.constructorParams=f});d.Anchors.Continuous=function(d){return d.jsPlumbInstance.continuousAnchorFactory.get(d)};d.AnchorPositionFinders=
{Fixed:function(d,f,k,c){return[(d.left-f.left)/k[0],(d.top-f.top)/k[1]]},Grid:function(d,f,k,c){var z=k[0]/c.grid[0];c=k[1]/c.grid[1];return[(Math.floor((d.left-f.left)/z)*z+z/2)/k[0],(Math.floor((d.top-f.top)/c)*c+c/2)/k[1]]}};d.Anchors.Perimeter=function(d){d=d||{};var f=d.anchorCount||40,k=d.shape;if(!k)throw Error("no shape supplied to Perimeter Anchor type");var c={circle:function(){for(var c=2*Math.PI/f,d=0,k=[],l=0;l<f;l++){var q=0.5+0.5*Math.sin(d),w=0.5+0.5*Math.cos(d);k.push([q,w,0,0]);
d+=c}return k},ellipse:function(){for(var c=2*Math.PI/f,k=0,t=[],w=0;w<f;w++){var q=0.5+d.rx*Math.sin(k),x=0.5+d.ry*Math.cos(k);t.push([q,x,0,0]);k+=c}return t}};if(!c[k])throw Error("Shape ["+k+"] is unknown by Perimeter Anchor type");k=c[k]();k=d.jsPlumbInstance.makeDynamicAnchor(k);k.type="Perimeter";return k}})();
