(function(m){var g=-1,k=0,l=0,p=0,h={selectSlice:function(b,c,e,d,a){return m.Deferred(function(f){var n=b.data("expanded"),l=b.data("position"),r,q,u=c.not(b);n?(b.data("expanded",!1),g=-1,q=r=k,b.find(".va-content").hide(),h.canSlideUp(c,a)?d.fadeIn():d.fadeOut(),h.canSlideDown(c,a)?e.fadeIn():e.fadeOut()):(b.data("expanded",!0),g=b.index(),u.data("expanded",!1),r=a.expandedHeight,q=Math.ceil((a.accordionH-a.expandedHeight)/(a.visibleSlices-1)),0<g?d.fadeIn():d.fadeOut(),g<p-1?e.fadeIn():e.fadeOut());
r={height:r+"px",opacity:1,top:(l-1)*q+"px"};b.stop().animate(r,a.animSpeed,a.animEasing,function(){n||b.find(".va-content").fadeIn(a.contentAnimSpeed)}).find(".va-title").stop().animate({lineHeight:k+"px"},a.animSpeed,a.animEasing);u.each(function(b){b=m(this);var c=b.data("position"),c=n?(c-1)*q:c<l?(c-1)*q:(c-2)*q+a.expandedHeight;b.stop().animate({top:c+"px",height:q+"px",opacity:n?1:a.animOpacity},a.animSpeed,a.animEasing,f.resolve).find(".va-title").stop().animate({lineHeight:q+"px"},a.animSpeed,
a.animEasing).end().find(".va-content").hide()})}).promise()},navigate:function(b,c,e,d,a){if(c.is(":animated"))return!1;var f;-1==g||a.savePositions?h.slide(b,c,e,d,a):(f=c.eq(g),m.when(h.selectSlice(f,c,e,d,a)).done(function(){setTimeout(function(){h.slide(b,c,e,d,a)},10)}))},slide:function(b,c,e,d,a){if(-1!==g&&a.savePositions){if(1===b&&g===p-1||-1===b&&0===g)return!1;-1===b&&1===g?d.fadeOut():d.fadeIn();1===b&&g===p-2?e.fadeOut():e.fadeIn()}else{if(1===b&&l+a.visibleSlices>=p||-1===b&&0===l)return!1;
-1===b&&1===l?d.fadeOut():d.fadeIn();1===b&&l+a.visibleSlices===p-1?e.fadeOut():e.fadeIn()}var f=c.eq(g),n,s;1===b?n=f.next():n=f.prev();if(1===b&&!h.canSlideDown(c,a)||-1===b&&!h.canSlideUp(c,a))return h.selectSlice(n,c,e,d,a),!1;1===b?(l++,s="-="+k,pos_increment=-1):(l--,s="+="+k,pos_increment=1);c.each(function(c){var d=m(this),e=d.data("position");if(a.savePositions&&-1!==g){var f;c===n.index()?(d.data("expanded",!0),g=d.index(),c=a.expandedHeight,f=(a.accordionH-a.expandedHeight)/(a.visibleSlices-
1),d.stop().animate({height:c+"px",opacity:1,top:1===b?(e-2)*f+"px":e*f+"px"},a.animSpeed,a.animEasing,function(){d.find(".va-content").fadeIn(a.contentAnimSpeed)}).find(".va-title").stop().animate({lineHeight:k+"px"},a.animSpeed,a.animEasing)):d.data("expanded")?(d.data("expanded",!1),f=(a.accordionH-a.expandedHeight)/(a.visibleSlices-1),d.stop().animate({height:f+"px",opacity:a.animOpacity,top:1===b?"-="+f:"+="+a.expandedHeight},a.animSpeed,a.animEasing).find(".va-title").stop().animate({lineHeight:f+
"px"},a.animSpeed,a.animEasing).end().find(".va-content").hide()):(d.data("expanded",!1),f=(a.accordionH-a.expandedHeight)/(a.visibleSlices-1),d.stop().animate({top:1===b?"-="+f:"+="+f},a.animSpeed,a.animEasing))}else d.stop().animate({top:s},a.animSpeed,a.animEasing);d.data().position+=pos_increment})},canSlideUp:function(b,c){if(0!==b.eq(l).index())return!0},canSlideDown:function(b,c){if(b.eq(l+c.visibleSlices-1).index()!==p-1)return!0}},t={init:function(b){if(this.length){var c={accordionW:900,
accordionH:350,visibleSlices:4,expandedHeight:350,animSpeed:250,animEasing:"jswing",animOpacity:0.5,contentAnimSpeed:1900,savePositions:!0};return this.each(function(){b&&m.extend(c,b);var e=m(this),d=e.find("div.va-slice"),a=e.find("span.va-nav-next"),f=e.find("span.va-nav-prev");k=Math.ceil(c.accordionH/c.visibleSlices);p=d.length;c.expandedHeight>c.accordionH?c.expandedHeight=c.accordionH:c.expandedHeight<=k&&(c.expandedHeight=k+50);e.css({width:c.accordionW+"px",height:c.accordionH+"px"});c.visibleSlices<
p&&a.show();d.each(function(a){m(this).css({top:a*k+"px",height:k+"px"}).data("position",a+1)}).children(".va-title").css("line-height",k+"px");d.bind("click.vaccordion",function(b){1<c.visibleSlices&&(b=m(this),h.selectSlice(b,d,a,f,c))});a.bind("click.vaccordion",function(b){h.navigate(1,d,a,f,c)});f.bind("click.vaccordion",function(b){h.navigate(-1,d,a,f,c)});e.bind("mousewheel.vaccordion",function(b,e){0<e?h.navigate(-1,d,a,f,c):h.navigate(1,d,a,f,c);return!1})})}}};m.fn.vaccordion=function(b){if(t[b])return t[b].apply(this,
Array.prototype.slice.call(arguments,1));if("object"!==typeof b&&b)m.error("Method "+b+" does not exist on jQuery.vaccordion");else return t.init.apply(this,arguments)}})(jQuery);
